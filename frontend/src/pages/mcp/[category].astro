---
import Breadcrumb from '@/components/Breadcrumb.tsx';
import ToolContainer from '@/components/tool/ToolContainer.tsx';
import ToolHead from '@/components/tool/ToolHead.tsx';
import BaseLayout from '@/layouts/BaseLayout.astro';
import { loadMcpData } from '@/lib/mcp-data-processor.tsx';

export async function getStaticPaths() {
  // Load data from input.json
  const { categories } = await loadMcpData();
  
  // Generate static paths for all categories
  const paths = categories.map((category) => ({
    params: { category: category.id },
    props: { category }
  }));

  return paths;
}

const { category } = Astro.props;
const { servers, categories: allCategories } = await loadMcpData();

// Filter servers for this category
const categoryServers = servers.filter(server => 
  server.categories.includes(category.id)
);

// Get category info
const categoryInfo = allCategories.find(cat => cat.id === category.id);

// Helper function to get category emoji
const getCategoryEmoji = (icon: string): string => {
  const iconMap: Record<string, string> = {
    'pickaxe': 'â›ï¸',
    'code': 'ğŸ’»',
    'brain': 'ğŸ§ ',
    'cloud-upload': 'â˜ï¸',
    'shield': 'ğŸ›¡ï¸',
    'bitcoin': 'â‚¿',
    'browser': 'ğŸŒ',
    'cloud': 'â˜ï¸',
    'message-circle': 'ğŸ’¬',
    'palette': 'ğŸ¨',
    'database': 'ğŸ—„ï¸',
    'terminal': 'ğŸ’»',
    'users': 'ğŸ‘¥',
    'star': 'â­',
    'tool': 'ğŸ”§'
  };
  return iconMap[icon] || 'ğŸ”§';
};

// SEO Data
const title = `${categoryInfo?.name || category.id} MCP Repositories - Browse ${categoryServers.length} Model Context Protocol Repositories | Free DevTools by Hexmos`;
const description = `Discover ${categoryServers.length} MCP repositories in the ${categoryInfo?.name || category.id} category. Find the perfect Model Context Protocol repository for your AI agent project.`;
const keywords = [
  'mcp repositories',
  'model context protocol',
  categoryInfo?.name || category.id,
  'ai agent tools',
  'mcp directory',
  'open source mcp'
];

// Breadcrumb data
const breadcrumbItems = [
  { label: 'Free DevTools', href: '/freedevtools/' },
  { label: 'MCP Directory', href: '/freedevtools/mcp/' },
  { label: categoryInfo?.name || category.id }
];
---

<BaseLayout 
  name={`${categoryInfo?.name || category.id} MCP Repositories`}
  title={title}
  path={`/freedevtools/mcp/${category.id}`}
  description={description}
  canonical={`https://hexmos.com/freedevtools/mcp/${category.id}`}
  themeColor="#3b82f6"
  keywords={keywords}
  ogImage="https://hexmos.com/freedevtools/tool-banners/mcp-directory-banner.png"
  twitterImage="https://hexmos.com/freedevtools/tool-banners/mcp-directory-banner.png"
  datePublished="2025-01-30"
  softwareVersion="1.0.0"
  features={[
    `Browse ${categoryServers.length} MCP repositories in ${categoryInfo?.name || category.id}`,
    'Filter by license and quality scores',
    'Search and sort functionality',
    'Detailed repository information'
  ]}
>
  <ToolContainer>
    
    <ToolHead 
      name={`${categoryInfo?.name || category.id} MCP Repositories`}
      description={`${categoryServers.length} repositories in this category. ${categoryInfo?.description || `MCP repositories in the ${category.id} category`}`}
      breadcrumbItems={breadcrumbItems}
      client:load
    />

    <!-- Repositories List -->
    <div class="space-y-4">
      {categoryServers.length === 0 ? (
        <div class="text-center py-12">
          <div class="text-6xl mb-4">ğŸ”</div>
          <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2">
            No repositories found
          </h3>
          <p class="text-gray-600 dark:text-gray-400">
            There are no MCP repositories in the {categoryInfo?.name || category.id} category yet.
          </p>
        </div>
      ) : (
        categoryServers.map((server) => (
          <a 
            href={`/freedevtools/mcp/${server.id}`}
            class="block bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg p-6 hover:shadow-md transition-all duration-300 hover:-translate-y-1 cursor-pointer"
          >
            <div class="flex items-start justify-between">
              <div class="flex-1">
                <div class="flex items-center space-x-3 mb-2">
                  <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100">
                    {server.name}
                  </h3>
                  <span class="px-2 py-1 text-xs font-medium bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded-full">
                    {server.license}
                  </span>
                </div>
                <p class="text-gray-600 dark:text-gray-400 mb-3">
                  {server.description}
                </p>
                <div class="flex items-center space-x-4 text-sm text-gray-500 dark:text-gray-400">
                  <div class="flex items-center space-x-1">
                    <img src="/freedevtools/svg_icons/grooveshark/github.svg" alt="GitHub" class="w-4 h-4 filter brightness-0 invert dark:brightness-100 dark:invert-0" />
                    <span>â­ {server.stats.githubStars}</span>
                  </div>
                  <div class="flex items-center space-x-1">
                    <img src="/freedevtools/svg_icons/cmake/npm.svg" alt="NPM" class="w-4 h-4" />
                    <span>ğŸ“¦ {server.stats.weeklyDownloads} weekly downloads</span>
                  </div>
                  <span>ğŸ› ï¸ {server.stats.tools} tools</span>
                  <span>ğŸ•’ {server.stats.lastUpdated}</span>
                </div>
              </div>
              <div class="flex items-center ml-4">
                <span class="text-gray-400 dark:text-gray-500">â†’</span>
              </div>
            </div>
          </a>
        ))
      )}
    </div>
  </div>
</BaseLayout>
